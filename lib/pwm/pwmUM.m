%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title: Optimisation in electric drives and inverters                    %
% Topic: Power Electronics, Distortions                                   %
% File: pwmUM                                                             %
% Date: 05.11.2021                                                        %
% Author: Dr. Pascal A. Schirmer                                          %
% Version: V.0.1                                                          %
% Copyright: Pascal Schirmer                                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [t0, t1, t2, t7, t07, k_f] = pwmUM(M_i, Theta_u_i, R, k, setup)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Init
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
T_s = 1/setup.fs;                                                           % Carrier switching time in [s]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Calculations
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
t1 = (2*sqrt(3))/pi * M_i * (sin(R*(pi/3) - Theta_u_i)).*T_s;
t2 = (2*sqrt(3))/pi * M_i * (sin(Theta_u_i - (R-1)*(pi/3))).*T_s;
t07 = T_s - t1 - t2;
t0 = t07.*k;
t7 = t07.*(1-k);
if(setup.SEQ == 121 || setup.SEQ == 7212 || setup.SEQ == 1012 || setup.SEQ == 2721)
    k_f = 1.0;
else
    if(k == 1.0 || k == 0.0)
        k_f = 1.5;
    else
        k_f = 1.0;
    end
end
end